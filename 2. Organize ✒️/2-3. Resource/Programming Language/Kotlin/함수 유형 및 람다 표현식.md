>(1) 날짜: 2024.06.08
>(2) 태그(주제/카테고리): #Kotlin #Function #Lambda

>(3) Link
- [[Kotlin]]
---

> Kotlin에서는 함수를 데이터 유형의 하나로 간주할 수 있습니다. 따라서 이를 변수에 할당하거나 다른 함수의 인자로 전달할 수 있으며 함수를 리터럴로 정의하는 람다 표현식과 같은 개념을 유용하게 사용할 수 있습니다.

## 변수에 함수 저장
- 다음의 코드 스니펫은 오류를 발생시킵니다.
```
fun main() {
    val trickFunction = trick
}

fun trick() {
    println("No treats!")
}
```
- 변수 `trickFunction`에 `trick()` 함수를 할당하려고 할 때, Kotlin 컴파일러는 `trick`을 함수의 이름으로 인식하지만 다음과 같은 오류를 발생시킵니다.
- `Function invocation 'trick()' expected`
- 왜냐하면 변수에 함수가 할당되는 대신 함수가 호출될 것으로 예상하기 때문입니다.
- 함수를 값으로 참조하려면 **함수 참조 연산자** `::`를 사용해야 합니다. 다음 문법을 참고하세요.
![[Pasted image 20240608134923.png]]
- 다음은 수정된 코드입니다.
```
fun main() {
    val trickFunction = ::trick
}

fun trick() {
    println("No treats!")
}
```


## 람다 표현식을 이용하여 함수 재정의
> 람다 표현식은 `fun` 키워드 없이 함수를 정의할 수 있는 간결한 문법입니다. 람다 표현식은 다른 함수에 관한 함수 참조 없이 변수에 직접 저장할 수 있습니다.

![[Pasted image 20240608135742.png]]
- 람다 표현식을 사용하여 함수를 정의할 경우 *그 함수를 참조하는 변수를 갖게 됩니다.* 
- 다른 유형처럼 그 값을 다른 변수에 할당하고 새 변수의 이름으로 함수를 호출할 수도 있습니다. 


## 함수를 데이터 유형으로 사용
- Kotlin 컴파일러는 유형 추론을 지원하므로 함수 데이터 유형 역시 추론할 수 있습니다.
- 그러나 함수 매개변수의 유형이나 반환 유형을 지정하려면 함수 유형을 표현하기 위한 문법을 알아야 합니다. 아래의 다이어그램을 참고하세요.

![[Pasted image 20240608141149.png]]
- 앞서 선언한 `trick` 변수의 데이터 유형은 `() -> Unit`입니다. 
	- 함수에 매개변수가 없으므로 괄호가 비어 있습니다.
	- 함수에서 아무것도 반환하지 않으므로 반환 유형은 `Unit` 입니다.
	- 두 개의 `Int` 매개변수를 사용하고 `Int`를 반환하는 함수이면 데이터 유형은 `(Int, Int) -> Int` 입니다.

- 데이터 유형을 지정한 `treat` 함수를 선언합니다.
```
val treat: () -> Unit = {
    println("Have a treat!")
}
```
- *명시적으로 지정*한 것이므로, 데이터 유형을 지정하지 않은 `trick`함수와 동일한 유형을 갖습니다.


## 함수를 반환 유형으로 사용
> 함수가 데이터 유형이므로 다른 데이터 유형처럼 반환 값으로 사용할 수도 있습니다.

![[Pasted image 20240608142204.png]]


## 함수를 다른 함수에 인수로 전달
- 다음과 같이 함수를 매개변수로 사용하도록 `trickOrTreat()` 함수를 업데이트합니다.
```
fun trickOrTreat(isTrick: Boolean, extraTreat: (Int) -> String): () -> Unit {
```

- 다음과 같이 전달할 함수를 정의하여 함수 호출 시에 인자로 전달합니다.
- 이때 `->`연산자를 이용하여 매개변수 목록과 함수 본문을 구분합니다.
```
fun main() {
    val coins: (Int) -> String = { quantity ->
        "$quantity quarters"
    }    
    val cupcake: (Int) -> String = {
        "Have a cupcake!"    
    }    
    
    val treatFunction = trickOrTreat(false, coins)
    val trickFunction = trickOrTreat(true, cupcake)
    treatFunction()
    trickFunction()
}
```


## `null`을 허용하는 함수 유형
![[Pasted image 20240608150452.png]]
- 위와 같이 괄호를 이용해 함수 유형을 괄호로 묶은 다음 `?`연산자를 추가합니다.
- 앞의 `trickOrTreat` 함수를 nullable하도록 수정할 경우 다음과 같이 명시적으로 `null` 검사를 수행합니다.
```
fun trickOrTreat(isTrick: Boolean, extraTreat: ((Int) -> String)?): () -> Unit {
    if (isTrick) {
        return trick    
    } else {
        if (extraTreat != null) {
            println(extraTreat(5))
        }        
        return treat    
    }
}
```


## 매개변수 이름 생략
![[Pasted image 20240608151232.png]]
- 함수에 매개변수가 한 개 있고 이름을 지정하지 않는 경우 Kotlin은 암시적으로 **매개변수에 `it` 이름을 할당합니다.**
- 이를 통해 *매개변수 이름과 `->` 기호를 생략*할 수 있고 람다 표현식을 더 간단하게 만들 수 있습니다.


## 람다 표현식을 함수에 직접 전달
- 변수를 통해 함수를 정의하지 않아도 람다 표현식을 `trickOrTreat()` 함수에 직접 전달할 수 있습니다.
- **람다 표현식은 함수 리터럴일 뿐입니다.** 이를 문자열 리터럴 `"Hello"` 처럼 직접 전달한다고 생각할 수 있습니다.
 ![[Pasted image 20240608151636.png]]
 - 따라서 `coins` 변수에 함수를 할당하는 과정을 생략하도록 코드를 다음과 같이 수정할 수 있습니다.
```
fun main() {
    val treatFunction = trickOrTreat(false, { "$it quarters" })
    val trickFunction = trickOrTreat(true, null)
    treatFunction()
    trickFunction()
}
```


## 후행 람다 문법 사용
> 함수 유형이 함수의 **마지막 매개변수**인 경우 닫는 괄호 다음에 람다 표현식을 배치하여 함수를 호출할 수 있습니다.

![[Pasted image 20240608151933.png]]
- 이렇게 하면 람다 표현식이 다른 매개변수와 구분되므로 코드를 더 쉽게 읽을 수 있으며 코드 기능은 변경되지 않습니다.
- 다음과 같이 코드를 수정하면 됩니다.
	- `val treatFunction = trickOrTreat(false) { "$it quarters" }`

- *UI를 선언하는 데 사용되는 Composable 함수는 함수를 매개변수로 취하며, 일반적으로 후행 람다 문법을 사용하여 호출됩니다.*


## `repeat()` 함수 사용
- 함수가 *함수를 반환*하거나 *함수를 인수로 취하는 경우* 이를 **고차 함수**라고 합니다. 
- 앞서 설명한 람다 지식으로 활용할 수 있는 유용한 고차 함수를 소개합니다.

- `repeat()` 함수는 `for` 루프를 함수로 표현할 수 있는 간결한 방법입니다.
- `repeat()` 함수 시그니처:
	- `repeat(times: Int, action: (Int) -> Unit)`
![[Pasted image 20240608152647.png]]
- 위 표현을 이용해 다음과 같이 사용해볼 수 있습니다.
```
fun main() {
    val treatFunction = trickOrTreat(false) { "$it quarters" }
    val trickFunction = trickOrTreat(true, null)
    repeat(4) {
        treatFunction()
    }    
    trickFunction()
}
```

>(5) Reference
- https://developer.android.com/codelabs/basic-android-kotlin-compose-function-types-and-lambda?hl=ko&continue=https%3A%2F%2Fdeveloper.android.com%2Fcourses%2Fpathways%2Fandroid-basics-compose-unit-2-pathway-1%3Fhl%3Dko%23codelab-https%3A%2F%2Fdeveloper.android.com%2Fcodelabs%2Fbasic-android-kotlin-compose-function-types-and-lambda#0